# Generated by automation script
from mlmodelscope.pytorch_agent.models.pytorch_abc import PyTorchAbstractClass

from mlmodelscope.pytorch_agent.models.pytorch_abc import PyTorchAbstractClass
from ultralytics import YOLO

class PyTorch_Ultralytics_YOLOv11_License_Plate_Detection(PyTorchAbstractClass):
    def __init__(self, config=None):
        self.config = config if config else dict()
        self.device = self.config.pop("_device", "cpu")
        multi_gpu = self.config.pop("_multi_gpu", False)

        # The ultralytics library handles device management.
        # We load the model from the specified Hugging Face model ID.
        self.model = YOLO('morsetechlab/yolov11-license-plate-detection')
        self.model.to(self.device)

    def preprocess(self, input_images):
        # The ultralytics model's predict method can directly take image paths.
        # The input_images are expected to be a list of file paths.
        model_input = input_images
        return model_input

    def predict(self, model_input):
        # The model was moved to the correct device in __init__.
        # The predict method takes the list of image paths as source.
        return self.model.predict(source=model_input)

    def postprocess(self, model_output):
        # The model_output is a list of ultralytics Results objects, one for each input image.
        # We process the results for the first image in the batch.
        results = model_output[0]
        scores = results.boxes.conf.tolist()
        labels = results.boxes.cls.tolist()
        boxes = results.boxes.xyxy.tolist()
        return [scores], [labels], [boxes]
