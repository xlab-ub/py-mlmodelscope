# Generated by automation script
from mlmodelscope.pytorch_agent.models.pytorch_abc import PyTorchAbstractClass

import torch
import yolov5
from PIL import Image
import warnings

class PyTorch_YOLOv5_keremberke_yolov5n_license_plate(PyTorchAbstractClass):
    def __init__(self):
        warnings.warn("The batch size should be 1.")
        self.model = yolov5.load('keremberke/yolov5n-license-plate')
        self.model.conf = 0.25
        self.model.iou = 0.45
        self.model.agnostic = False
        self.model.multi_label = False
        self.model.max_det = 1000

    def preprocess(self, input_images):
        # The yolov5 model takes image paths directly
        return input_images

    def predict(self, model_input):
        return self.model(model_input, size=640)

    def postprocess(self, model_output):
        # model_output.pred is a list of tensors, one for each image in the batch
        predictions = model_output.pred[0]
        boxes = predictions[:, :4].tolist()
        scores = predictions[:, 4].tolist()
        labels = predictions[:, 5].tolist()
        return [scores], [labels], [boxes]
