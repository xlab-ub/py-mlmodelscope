# Generated by automation script
from mlmodelscope.pytorch_agent.models.pytorch_abc import PyTorchAbstractClass

from transformers import AutoImageProcessor, AutoModelForSemanticSegmentation
from PIL import Image
from mlmodelscope.pytorch_agent.models.pytorch_abc import PyTorchAbstractClass

class PyTorch_Transformers_Seg_Zero_7B(PyTorchAbstractClass):
    def __init__(selfself, config):
        super().__init__(config)
        model_id = "Ricky06662/Seg-Zero-7B"
        # This model is a CausalLM and not a standard Semantic Segmentation model.
        # The following lines are a template and will likely fail as the model architecture is not compatible with AutoModelForSemanticSegmentation.
        self.processor = AutoImageProcessor.from_pretrained(model_id, trust_remote_code=True)
        self.model = self.load_hf_model(AutoModelForSemanticSegmentation, model_id, trust_remote_code=True)

    def preprocess(self, input_images):
        images = [Image.open(path).convert("RGB") for path in input_images]
        model_input = self.processor(images=images, return_tensors="pt")
        return model_input

    def predict(self, model_input):
        return self.model(**model_input)

    def postprocess(self, model_output):
        return model_output.logits.argmax(dim=1).tolist()
